clear all; close all;
image = imread('checker.jpg');
imgpoints = Get2DPoints('checker.jpg', 18);
x = imgpoints(1,:);
y = imgpoints(2,:);
18 = [0,0,0];
wp17 = [0,0,1];
wp16 = [0,0,2];
wp15 = [0,0,3];
wp14 = [1,0,0];
wp13 = [2,0,0];
wp12 = [3,0,0];
wp11 = [0,1,0];
wp10 = [0,2,0];
wp9 = [0,4,0];
wp8 = [1,0,1];
wp7 = [2,0,2];
wp6= [1,1,0];
wp5= [2,2,0];
wp4= [0,1,1];
wp3= [0,2,2];
wp2= [0,1,2];
wp1= [0,2,1];

A6 = [ wp1(1) wp1(2) wp1(3) 1 0 0 0 0 -x(1)*wp1(1) -x(1)*wp1(2) -x(1)*wp1(3) -x(1);
    0 0 0 0 wp1(1) wp1(2) wp1(3) 1 -y(1)*wp1(1) -y(1)*wp1(2) -y(1)*wp1(3) -y(1);
    wp2(1) wp2(2) wp2(3) 1 0 0 0 0 -x(2)*wp2(1) -x(2)*wp2(2) -x(2)*wp2(3) -x(2);
    0 0 0 0 wp2(1) wp2(2) wp2(3) 1 -y(2)*wp2(1) -y(2)*wp2(2) -y(2)*wp2(3) -y(2);
   wp3(1) wp3(2) wp3(3) 1 0 0 0 0 -x(3)*wp3(1) -x(3)*wp3(2) -x(3)*wp3(3) -x(3);
    0 0 0 0 wp3(1) wp3(2) wp3(3) 1 -y(3)*wp3(1) -y(3)*wp3(2) -y(3)*wp3(3) -y(3);
    wp4(1) wp4(2) wp4(3) 1 0 0 0 0 -x(4)*wp4(1) -x(4)*wp4(2) -x(4)*wp4(3) -x(4);
    0 0 0 0 wp4(1) wp4(2) wp4(3) 1 -y(4)*wp4(1) -y(4)*wp4(2) -y(4)*wp4(3) -y(4);
    wp5(1) wp5(2) wp5(3) 1 0 0 0 0 -x(5)*wp5(1) -x(5)*wp5(2) -x(5)*wp5(3) -x(5);
    0 0 0 0 wp5(1) wp5(2) wp5(3) 1 -y(5)*wp5(1) -y(5)*wp5(2) -y(5)*wp5(3) -y(5);
   wp6(1) wp6(2) wp6(3) 1 0 0 0 0 -x(6)*wp6(1) -x(6)*wp6(2) -x(6)*wp6(3) -x(6);
    0 0 0 0 wp6(1) wp6(2) wp6(3) 1 -y(6)*wp6(1) -y(6)*wp6(2) -y(6)*wp6(3) -y(6)]

[U,S,V] = svd(A6);
P6 =  V(:,12);
P6 =  [P6(1) P6(2) P6(3) P6(4);
    P6(5) P6(6) P6(7) P6(8); P6(9) P6(10) P6(11) P6(12)];
P6

IP6_1 = P6*[wp1(1); wp1(2); wp1(3); 1];
IP6_2 = P6*[wp2(1); wp2(2); wp2(3); 1];
IP6_3 = P6*[wp3(1); wp3(2); wp3(3); 1];
IP6_4 = P6*[wp4(1); wp4(2); wp4(3); 1];
IP6_5 = P6*[wp5(1); wp5(2); wp5(3); 1];
IP6_6 = P6*[wp6(1); wp6(2); wp6(3); 1];
IP6_7 = P6*[wp7(1); wp7(2); wp7(3); 1];
IP6_8 = P6*[wp8(1); wp8(2); wp8(3); 1];
IP6_9 = P6*[wp9(1); wp9(2); wp9(3); 1];

ip6_1 = IP6_1./IP6_1(3);
ip6_2 = IP6_2./IP6_2(3);
ip6_3 = IP6_3./IP6_3(3);
ip6_4 = IP6_4./IP6_4(3);
ip6_5 = IP6_5./IP6_5(3);
ip6_6 = IP6_6./IP6_6(3);
ip6_7 = IP6_7./IP6_6(3);
ip6_8 = IP6_8./IP6_6(3);
ip6_9 = IP6_9./IP6_6(3);
E6_1 = sqrt((x(1)-ip6_1(1))^2 + (y(1)-ip6_1(2))^2);
E6_2 = sqrt((x(2)-ip6_2(1))^2 + (y(2)-ip6_2(2))^2);
E6_3 = sqrt((x(3)-ip6_3(1))^2 + (y(3)-ip6_3(2))^2);
E6_4 = sqrt((x(4)-ip6_4(1))^2 + (y(4)-ip6_4(2))^2);
E6_5 = sqrt((x(5)-ip6_5(1))^2 + (y(5)-ip6_5(2))^2);
E6_6 = sqrt((x(6)-ip6_6(1))^2 + (y(6)-ip6_6(2))^2);
E6_7 = sqrt((x(7)-ip6_7(1))^2 + (y(7)-ip6_7(2))^2);
E6_8 = sqrt((x(8)-ip6_8(1))^2 + (y(8)-ip6_8(2))^2);
E6_9 = sqrt((x(9)-ip6_8(1))^2 + (y(9)-ip6_9(2))^2);

E6 = (E6_1 + E6_2 + E6_3 +E6_4 +E6_5 +E6_6 +E6_7 +E6_8 +E6_9)/9;

A12 = [ wp1(1) wp1(2) wp1(3) 1 0 0 0 0 -x(1)*wp1(1) -x(1)*wp1(2) -x(1)*wp1(3) -x(1);
    0 0 0 0 wp1(1) wp1(2) wp1(3) 1 -y(1)*wp1(1) -y(1)*wp1(2) -y(1)*wp1(3) -y(1);
    wp2(1) wp2(2) wp2(3) 1 0 0 0 0 -x(2)*wp2(1) -x(2)*wp2(2) -x(2)*wp2(3) -x(2);
    0 0 0 0 wp2(1) wp2(2) wp2(3) 1 -y(2)*wp2(1) -y(2)*wp2(2) -y(2)*wp2(3) -y(2);
   wp3(1) wp3(2) wp3(3) 1 0 0 0 0 -x(3)*wp3(1) -x(3)*wp3(2) -x(3)*wp3(3) -x(3);
    0 0 0 0 wp3(1) wp3(2) wp3(3) 1 -y(3)*wp3(1) -y(3)*wp3(2) -y(3)*wp3(3) -y(3);
    wp4(1) wp4(2) wp4(3) 1 0 0 0 0 -x(4)*wp4(1) -x(4)*wp4(2) -x(4)*wp4(3) -x(4);
    0 0 0 0 wp4(1) wp4(2) wp4(3) 1 -y(4)*wp4(1) -y(4)*wp4(2) -y(4)*wp4(3) -y(4);
    wp5(1) wp5(2) wp5(3) 1 0 0 0 0 -x(5)*wp5(1) -x(5)*wp5(2) -x(5)*wp5(3) -x(5);
    0 0 0 0 wp5(1) wp5(2) wp5(3) 1 -y(5)*wp5(1) -y(5)*wp5(2) -y(5)*wp5(3) -y(5);
   wp6(1) wp6(2) wp6(3) 1 0 0 0 0 -x(6)*wp6(1) -x(6)*wp6(2) -x(6)*wp6(3) -x(6);
    0 0 0 0 wp6(1) wp6(2) wp6(3) 1 -y(6)*wp6(1) -y(6)*wp6(2) -y(6)*wp6(3) -y(6);
    wp7(1) wp7(2) wp7(3) 1 0 0 0 0 -x(7)*wp7(1) -x(7)*wp7(2) -x(7)*wp7(3) -x(7);
    0 0 0 0 wp7(1) wp7(2) wp7(3) 1 -y(7)*wp7(1) -y(7)*wp7(2) -y(7)*wp7(3) -y(7);
    wp8(1) wp8(2) wp8(3) 1 0 0 0 0 -x(8)*wp8(1) -x(8)*wp8(2) -x(8)*wp8(3) -x(8);
    0 0 0 0 wp8(1) wp8(2) wp8(3) 1 -y(8)*wp8(1) -y(8)*wp8(2) -y(8)*wp8(3) -y(8);
    wp9(1) wp9(2) wp9(3) 1 0 0 0 0 -x(9)*wp9(1) -x(9)*wp9(2) -x(9)*wp9(3) -x(9);
    0 0 0 0 wp9(1) wp9(2) wp9(3) 1 -y(9)*wp9(1) -y(9)*wp9(2) -y(9)*wp9(3) -y(9);
    wp10(1) wp10(2) wp10(3) 1 0 0 0 0 -x(10)*wp10(1) -x(10)*wp10(2) -x(10)*wp10(3) -x(10);
    0 0 0 0 wp10(1) wp10(2) wp10(3) 1 -y(10)*wp10(1) -y(10)*wp10(2) -y(10)*wp10(3) -y(10);
    wp11(1) wp11(2) wp11(3) 1 0 0 0 0 -x(11)*wp11(1) -x(11)*wp11(2) -x(11)*wp11(3) -x(11);
    0 0 0 0 wp11(1) wp11(2) wp11(3) 1 -y(11)*wp11(1) -y(11)*wp11(2) -y(11)*wp11(3) -y(11);
    wp12(1) wp12(2) wp12(3) 1 0 0 0 0 -x(12)*wp12(1) -x(12)*wp12(2) -x(12)*wp12(3) -x(12);
    0 0 0 0 wp12(1) wp12(2) wp12(3) 1 -y(12)*wp12(1) -y(12)*wp12(2) -y(12)*wp12(3) -y(12)]

[U,S,V] = svd(A12);
P12 =  V(:,12);
P12 =  [P12(1) P12(2) P12(3) P12(4);
    P12(5) P12(6) P12(7) P12(8); P12(9) P12(10) P12(11) P12(12)];

 IP12_1 = P12*[wp1(1); wp1(2); wp1(3); 1];

IP12_2 = P12*[wp2(1); wp2(2); wp2(3); 1];

IP12_3 = P12*[wp3(1); wp3(2); wp3(3); 1];

IP12_4 = P12*[wp4(1); wp4(2); wp4(3); 1];

IP12_5 = P12*[wp5(1); wp5(2); wp5(3); 1];

IP12_6 = P12*[wp6(1); wp6(2); wp6(3); 1];

IP12_7 = P12*[wp7(1); wp7(2); wp7(3); 1];

IP12_8 = P12*[wp8(1); wp8(2); wp8(3); 1];

IP12_9 = P12*[wp9(1); wp9(2); wp9(3); 1];

ip12_1 = IP12_1./IP12_1(3);
ip12_2 = IP12_2./IP12_2(3);
ip12_3 = IP12_3./IP12_3(3);
ip12_4 = IP12_4./IP12_4(3);
ip12_5 = IP12_5./IP12_5(3);
ip12_6 = IP12_6./IP12_6(3);
ip12_7 = IP12_7./IP12_7(3);
ip12_8 = IP12_8./IP12_8(3);
ip12_9 = IP12_9./IP12_9(3);

E12_1 = sqrt((x(1)-ip12_1(1))^2 + (y(1)-ip12_1(2))^2);
E12_2 = sqrt((x(2)-ip12_2(1))^2 + (y(2)-ip12_2(2))^2);
E12_3 = sqrt((x(3)-ip12_3(1))^2 + (y(3)-ip12_3(2))^2);
E12_4 = sqrt((x(4)-ip12_4(1))^2 + (y(4)-ip12_4(2))^2);
E12_5 = sqrt((x(5)-ip12_5(1))^2 + (y(5)-ip12_5(2))^2);
E12_6 = sqrt((x(6)-ip12_6(1))^2 + (y(6)-ip12_6(2))^2);
E12_7 = sqrt((x(7)-ip12_7(1))^2 + (y(7)-ip12_7(2))^2);
E12_8 = sqrt((x(8)-ip12_8(1))^2 + (y(8)-ip12_8(2))^2);
E12_9 = sqrt((x(9)-ip12_8(1))^2 + (y(9)-ip12_9(2))^2);

E12 = (E12_1 + E12_2 + E12_3 +E12_4 +E12_5 +E12_6 +E12_7 +E12_8 +E12_9)/9;
E12


A18 = [ wp1(1) wp1(2) wp1(3) 1 0 0 0 0 -x(1)*wp1(1) -x(1)*wp1(2) -x(1)*wp1(3) -x(1);
    0 0 0 0 wp1(1) wp1(2) wp1(3) 1 -y(1)*wp1(1) -y(1)*wp1(2) -y(1)*wp1(3) -y(1);
    wp2(1) wp2(2) wp2(3) 1 0 0 0 0 -x(2)*wp2(1) -x(2)*wp2(2) -x(2)*wp2(3) -x(2);
    0 0 0 0 wp2(1) wp2(2) wp2(3) 1 -y(2)*wp2(1) -y(2)*wp2(2) -y(2)*wp2(3) -y(2);
   wp3(1) wp3(2) wp3(3) 1 0 0 0 0 -x(3)*wp3(1) -x(3)*wp3(2) -x(3)*wp3(3) -x(3);
    0 0 0 0 wp3(1) wp3(2) wp3(3) 1 -y(3)*wp3(1) -y(3)*wp3(2) -y(3)*wp3(3) -y(3);
    wp4(1) wp4(2) wp4(3) 1 0 0 0 0 -x(4)*wp4(1) -x(4)*wp4(2) -x(4)*wp4(3) -x(4);
    0 0 0 0 wp4(1) wp4(2) wp4(3) 1 -y(4)*wp4(1) -y(4)*wp4(2) -y(4)*wp4(3) -y(4);
    wp5(1) wp5(2) wp5(3) 1 0 0 0 0 -x(5)*wp5(1) -x(5)*wp5(2) -x(5)*wp5(3) -x(5);
    0 0 0 0 wp5(1) wp5(2) wp5(3) 1 -y(5)*wp5(1) -y(5)*wp5(2) -y(5)*wp5(3) -y(5);
   wp6(1) wp6(2) wp6(3) 1 0 0 0 0 -x(6)*wp6(1) -x(6)*wp6(2) -x(6)*wp6(3) -x(6);
    0 0 0 0 wp6(1) wp6(2) wp6(3) 1 -y(6)*wp6(1) -y(6)*wp6(2) -y(6)*wp6(3) -y(6);
    wp7(1) wp7(2) wp7(3) 1 0 0 0 0 -x(7)*wp7(1) -x(7)*wp7(2) -x(7)*wp7(3) -x(7);
    0 0 0 0 wp7(1) wp7(2) wp7(3) 1 -y(7)*wp7(1) -y(7)*wp7(2) -y(7)*wp7(3) -y(7);
    wp8(1) wp8(2) wp8(3) 1 0 0 0 0 -x(8)*wp8(1) -x(8)*wp8(2) -x(8)*wp8(3) -x(8);
    0 0 0 0 wp8(1) wp8(2) wp8(3) 1 -y(8)*wp8(1) -y(8)*wp8(2) -y(8)*wp8(3) -y(8);
    wp9(1) wp9(2) wp9(3) 1 0 0 0 0 -x(9)*wp9(1) -x(9)*wp9(2) -x(9)*wp9(3) -x(9);
    0 0 0 0 wp9(1) wp9(2) wp9(3) 1 -y(9)*wp9(1) -y(9)*wp9(2) -y(9)*wp9(3) -y(9);
    wp10(1) wp10(2) wp10(3) 1 0 0 0 0 -x(10)*wp10(1) -x(10)*wp10(2) -x(10)*wp10(3) -x(10);
    0 0 0 0 wp10(1) wp10(2) wp10(3) 1 -y(10)*wp10(1) -y(10)*wp10(2) -y(10)*wp10(3) -y(10);
    wp11(1) wp11(2) wp11(3) 1 0 0 0 0 -x(11)*wp11(1) -x(11)*wp11(2) -x(11)*wp11(3) -x(11);
    0 0 0 0 wp11(1) wp11(2) wp11(3) 1 -y(11)*wp11(1) -y(11)*wp11(2) -y(11)*wp11(3) -y(11);
    wp12(1) wp12(2) wp12(3) 1 0 0 0 0 -x(12)*wp12(1) -x(12)*wp12(2) -x(12)*wp12(3) -x(12);
    0 0 0 0 wp12(1) wp12(2) wp12(3) 1 -y(12)*wp12(1) -y(12)*wp12(2) -y(12)*wp12(3) -y(12);
    wp13(1) wp13(2) wp13(3) 1 0 0 0 0 -x(13)*wp13(1) -x(13)*wp13(2) -x(13)*wp13(3) -x(13);

    0 0 0 0 wp13(1) wp13(2) wp13(3) 1 -y(13)*wp13(1) -y(13)*wp13(2) -y(13)*wp13(3) -y(13);

wp14(1) wp14(2) wp14(3) 1 0 0 0 0 -x(14)*wp14(1) -x(14)*wp14(2) -x(14)*wp14(3) -x(14);

    0 0 0 0 wp14(1) wp14(2) wp14(3) 1 -y(14)*wp14(1) -y(14)*wp14(2) -y(14)*wp14(3) -y(14);

wp15(1) wp15(2) wp15(3) 1 0 0 0 0 -x(15)*wp15(1) -x(15)*wp15(2) -x(15)*wp15(3) -x(15);

    0 0 0 0 wp15(1) wp15(2) wp15(3) 1 -y(15)*wp15(1) -y(15)*wp15(2) -y(15)*wp15(3) -y(15);

wp16(1) wp16(2) wp16(3) 1 0 0 0 0 -x(15)*wp16(1) -x(16)*wp16(2) -x(16)*wp16(3) -x(16);

    0 0 0 0 wp16(1) wp16(2) wp16(3) 1 -y(15)*wp16(1) -y(16)*wp16(2) -y(16)*wp16(3) -y(16);

wp17(1) wp17(2) wp17(3) 1 0 0 0 0 -x(17)*wp17(1) -x(17)*wp17(2) -x(17)*wp17(3) -x(17);
    0 0 0 0 wp17(1) wp17(2) wp17(3) 1 -y(17)*wp17(1) -y(17)*wp17(2) -y(17)*wp17(3) -y(18);wp18(1) wp18(2) wp18(3) 1 0 0 0 0 -x(18)*wp18(1) -x(18)*wp18(2) -x(18)*wp18(3) -x(18);

    0 0 0 0 wp18(1) wp18(2) wp18(3) 1 -y(18)*wp18(1) -y(18)*wp18(2) -y(18)*wp18(3) -y(18) ]

 
[U,S,V] = svd(A18);
P18 =  V(:,12);
P18 =  [P18(1) P18(2) P18(3) P18(4);
    P18(5) P18(6) P18(7) P18(8); P18(9) P18(10) P18(11) P18(12)];
 
 IP18_1 = P18*[wp1(1); wp1(2); wp1(3); 1];
 
IP18_2 = P18*[wp2(1); wp2(2); wp2(3); 1];
 
IP18_3 = P18*[wp3(1); wp3(2); wp3(3); 1];
 
IP18_4 = P18*[wp4(1); wp4(2); wp4(3); 1];
 
IP18_5 = P18*[wp5(1); wp5(2); wp5(3); 1];
 
IP18_6 = P18*[wp6(1); wp6(2); wp6(3); 1];
 
IP18_7 = P18*[wp7(1); wp7(2); wp7(3); 1];
 
IP18_8 = P18*[wp8(1); wp8(2); wp8(3); 1];
 
IP18_9 = P18*[wp9(1); wp9(2); wp9(3); 1];
 
ip18_1 = IP18_1./IP18_1(3);
ip18_2 = IP18_2./IP18_2(3);
ip18_3 = IP18_3./IP18_3(3);
ip18_4 = IP18_4./IP18_4(3);
ip18_5 = IP18_5./IP18_5(3);
ip18_6 = IP18_6./IP18_6(3);
ip18_7 = IP18_7./IP18_7(3);
ip18_8 = IP18_8./IP18_8(3);
ip18_9 = IP18_9./IP18_9(3);
 
E18_1 = sqrt((x(1)-ip18_1(1))^2 + (y(1)-ip18_1(2))^2);
E18_2 = sqrt((x(2)-ip18_2(1))^2 + (y(2)-ip18_2(2))^2);
E18_3 = sqrt((x(3)-ip18_3(1))^2 + (y(3)-ip18_3(2))^2);
E18_4 = sqrt((x(4)-ip18_4(1))^2 + (y(4)-ip18_4(2))^2);
E18_5 = sqrt((x(5)-ip18_5(1))^2 + (y(5)-ip18_5(2))^2);
E18_6 = sqrt((x(6)-ip18_6(1))^2 + (y(6)-ip18_6(2))^2);
E18_7 = sqrt((x(7)-ip18_7(1))^2 + (y(7)-ip18_7(2))^2);
E18_8 = sqrt((x(8)-ip18_8(1))^2 + (y(8)-ip18_8(2))^2);
E18_9 = sqrt((x(9)-ip18_9(1))^2 + (y(9)-ip18_9(2))^2);
 
E18 = (E18_1 + E18_2 + E18_3 +E18_4 +E18_5 +E18_6 +E18_7 +E18_8 +E18_9)/9;








